{% extends 'base.html' %}

{% block title %}Notas | SCRUM ACADEMY{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<h2 class="titulo">Notas dos Exercic√≠os:</h2>
<section class="area_graficos">
    <div class="graficos">
        <canvas id="grafico_modulo1"></canvas>
        <p>M√≥dulo 1 - Introdu√ß√£o ao Scrum </p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo2"></canvas>
        <p>M√≥dulo 2 - Fundamentos do Agile </p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo3"></canvas>
        <p>M√≥dulo 3 - Pap√©is</p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo4"></canvas>
        <p>M√≥dulo 4 - Eventos e Cerim√¥nias</p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo5"></canvas>
        <p>M√≥dulo 5 - Artefatos </p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo6"></canvas>
        <p>M√≥dulo 6 - Estimativa e Planejamento </p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo7"></canvas>
        <p>M√≥dulo 7 - Scrum Board e Ferramentas </p>
    </div>

    <div class="graficos">
        <canvas id="grafico_modulo8"></canvas>
        <p>M√≥dulo 8 - Boas Pr√°ticas e Dicas </p>
    </div>
</section>

<!-- SE√á√ÉO DO CERTIFICADO -->
<section id="certificado-section" class="certificado-section certificado-bloqueado">
    <div class="certificado-icon">üèÜ</div>
    <h2 class="certificado-title">Certificado de Conclus√£o</h2>
    <p class="certificado-descricao">
        Complete todos os m√≥dulos com nota m√≠nima de 70% para desbloquear seu certificado oficial!
    </p>
    
    <div class="certificado-requisitos">
        <h3 style="margin-bottom: 1rem;">Requisitos:</h3>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo1">‚≠ï</span>
            <span>M√≥dulo 1: <span id="nota-modulo1">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo2">‚≠ï</span>
            <span>M√≥dulo 2: <span id="nota-modulo2">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo3">‚≠ï</span>
            <span>M√≥dulo 3: <span id="nota-modulo3">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo4">‚≠ï</span>
            <span>M√≥dulo 4: <span id="nota-modulo4">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo5">‚≠ï</span>
            <span>M√≥dulo 5: <span id="nota-modulo5">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo6">‚≠ï</span>
            <span>M√≥dulo 6: <span id="nota-modulo6">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo7">‚≠ï</span>
            <span>M√≥dulo 7: <span id="nota-modulo7">0%</span></span>
        </div>
        <div class="requisito-item">
            <span class="requisito-check" id="check-modulo8">‚≠ï</span>
            <span>M√≥dulo 8: <span id="nota-modulo8">0%</span></span>
        </div>
    </div>

    <div class="progresso-total">
        <p>M√≥dulos Aprovados: <span id="modulos-aprovados">0/8</span></p>
    </div>

    <button id="btn-acessar-certificado" class="btn-certificado" disabled>
        üîí Certificado Bloqueado
    </button>
</section>


<script type="module" src="{{ url_for('static', filename='script/main-script.js')}}"></script>
<script>
    // Verificar elegibilidade do certificado
    const memoria = {
        modulo1: { porcentagemAcertos: 'modulo1Acertos' },
        modulo2: { porcentagemAcertos: 'modulo2Acertos' },
        modulo3: { porcentagemAcertos: 'modulo3Acertos' },
        modulo4: { porcentagemAcertos: 'modulo4Acertos' },
        modulo5: { porcentagemAcertos: 'modulo5Acertos' },
        modulo6: { porcentagemAcertos: 'modulo6Acertos' },
        modulo7: { porcentagemAcertos: 'modulo7Acertos' },
        modulo8: { porcentagemAcertos: 'modulo8Acertos' }
    };

    const gerenciador = {
        getStorage(chave) {
            return JSON.parse(localStorage.getItem(chave));
        }
    };

    // Verificar certificado quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('=== DEBUG: Verificando Certificado ===');
        verificarCertificado();
    });

    function verificarCertificado() {
        const modulos = ['modulo1', 'modulo2', 'modulo3', 'modulo4', 
                        'modulo5', 'modulo6', 'modulo7', 'modulo8'];
        
        let aprovados = 0;
        let todasNotasAcima70 = true;

        modulos.forEach((modulo) => {
            
            const chaveNota = memoria[modulo].porcentagemAcertos;
            const nota = parseFloat(gerenciador.getStorage(chaveNota)) || 0;
            
            console.log(`${modulo}: ${nota}% (chave: ${chaveNota})`);
            
            const notaElement = document.getElementById(`nota-${modulo}`);
            const checkElement = document.getElementById(`check-${modulo}`);
            
            if (notaElement) {
                notaElement.textContent = nota.toFixed(0) + '%';
            }
            
            if (nota >= 70) {
                aprovados++;
                if (checkElement) {
                    checkElement.textContent = '‚úÖ';
                    checkElement.style.color = '#10b981';
                }
            } else {
                todasNotasAcima70 = false;
                if (checkElement) {
                    checkElement.textContent = '‚ùå';
                    checkElement.style.color = '#ef4444';
                }
            }
        });

        // Atualizar contador
        document.getElementById('modulos-aprovados').textContent = `${aprovados}/8`;

        // Atualizar bot√£o e se√ß√£o
        const btnCertificado = document.getElementById('btn-acessar-certificado');
        const certificadoSection = document.getElementById('certificado-section');

        if (todasNotasAcima70) {
            btnCertificado.disabled = false;
            btnCertificado.textContent = 'üéì Acessar Meu Certificado';
            btnCertificado.onclick = () => window.location.href = '{{ url_for("certificado") }}';
            certificadoSection.classList.remove('certificado-bloqueado');
            
            // Adicionar anima√ß√£o de comemora√ß√£o
            setTimeout(() => {
                confetti();
            }, 500);
        } else {
            btnCertificado.disabled = true;
            btnCertificado.textContent = 'üîí Certificado Bloqueado';
            btnCertificado.onclick = () => {
                btnCertificado.classList.add('shake');
                setTimeout(() => btnCertificado.classList.remove('shake'), 500);
            };
        }
    }

    // Fun√ß√£o simples de confetti (opcional)
    function confetti() {
        const duration = 3000;
        const end = Date.now() + duration;

        (function frame() {
            const timeLeft = end - Date.now();
            if (timeLeft <= 0) return;

            const particleCount = 2;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = '-10px';
                particle.style.width = '10px';
                particle.style.height = '10px';
                particle.style.backgroundColor = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 4)];
                particle.style.borderRadius = '50%';
                particle.style.zIndex = '9999';
                particle.style.animation = 'fall 3s linear';
                
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 3000);
            }

            requestAnimationFrame(frame);
        }());
    }

    // CSS da anima√ß√£o de queda
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
</script>


<script type="module" src="{{ url_for('static', filename='script/main-script.js')}}"></script>
{% endblock %}